<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Springs Data</title>
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
  
  <!-- Caroline Rose | cmrrose.github.com | March 2019 | Wisconsin Geological and Natural History Survey-->
  
  <!-- Load Leaflet from a CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@^1/dist/leaflet.css" />
  <script src="https://cdn.jsdelivr.net/npm/leaflet@^1/dist/leaflet.js"></script>

  <!-- Load Esri Leaflet from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/esri-leaflet@^2/dist/esri-leaflet.js"></script>

  <!-- Load Web Component base -->
  <script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.2.10/webcomponents-loader.js"></script>
  <script src="./js/common.js"></script>

  <link rel="stylesheet" href="css/reset.css" />
  <link rel="stylesheet" href="css/variables.css" />
  <link rel="stylesheet" href="css/typography.css" />

  <style>
    #app {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
    }
    @media (min-width: 770px) {
      #app {
        display: grid;
        grid-template-columns: 50% 50%;
      }
      #sidebar {
        overflow-y: scroll;
      }
    }
    @media (max-width: 769px) {
      #app {
        display: grid;
        grid-template-rows: 80% 100%;
        overflow-y: scroll;
      }
      #map {
        grid-row-start: 1;
      }
    }
  </style>
  <script src="./lit/index.js"></script>
</head>
<body>
  <div id="app">
    <app-sidebar id="sidebar" title="Wisconsin Geological and Natural History Survey">
      <div>Some content</div>
      <section>
        <h2>
          Section 1
        </h2>
        <p>
          Lorem ipsum dolor sit amet, viris efficiendi suscipiantur 
          quo eu, eam altera iudicabit eu. Eu per molestie antiopam, 
          eam in nemore iracundia, cum ei audiam iuvaret. Sed an erat 
          sonet dolor, option lucilius sed cu, qui sadipscing 
          comprehensam te. Magna recusabo intellegebat mei in. Purto 
          rebum tibique no qui, enim minim eleifend ut pro.
        </p>
        <p>
          Eum errem iisque facilis ut. Ne vis affert sanctus indoctum, 
          mea purto homero id. Eam at scripta noluisse ponderum, per 
          prima mucius et. No omnes congue accusam has, an vero 
          euismod interesset pro. Dicta postea veritus per cu, id 
          quodsi hendrerit definitiones pro. In nec animal tractatos, 
          per paulo congue ea.
        </p>
        <p>
          Nobis splendide ex nam. Vis at periculis delicatissimi. Vel 
          at elit dolores, <a href="#">sit aeque forensibus</a> id. His erat saepe et, 
          everti sententiae pri te, accusam expetenda consequat eum cu. 
          Hinc omnis mei ei. His ei tantas animal.
        </p>
        <p>
          Quo et facete habemus posidonium, sed in esse eripuit 
          deserunt, modo adipiscing complectitur ut vix. Persius 
          labores eleifend an quo, eos et nostrum suscipiantur. Mei 
          ex liber euripidis incorrupte. Ius ei odio ridens, laoreet 
          maluisset at qui. Eu harum necessitatibus pro, vitae 
          verterem repudiare eu has, solum concludaturque eam ei.
        </p>
        <p>
          In nec esse clita graeci, quodsi doctus ne est. Ad vim 
          detraxit elaboraret. Duo cibo verear ponderum ei. Te mei 
          patrioque consetetur. Cum cu mollis impetus. Vis an quas 
          graecis oportere, ut legimus vocibus mei.
        </p>
      </section>
        
      <section>
        <h2>
          Section 2
        </h2>
        <p>
          Lorem ipsum dolor sit amet, viris efficiendi suscipiantur 
          quo eu, eam altera iudicabit eu. Eu per molestie antiopam, 
          eam in nemore iracundia, cum ei audiam iuvaret. Sed an erat 
          sonet dolor, <a href="#">option lucilius</a> sed cu, qui sadipscing 
          comprehensam te. Magna recusabo intellegebat mei in. Purto 
          rebum tibique no qui, enim minim eleifend ut pro.
        </p>
        <p>
          Eum errem iisque facilis ut. Ne vis affert sanctus indoctum, 
          mea purto homero id. Eam at scripta noluisse ponderum, per 
          prima mucius et. No omnes congue accusam has, an vero 
          euismod interesset pro. Dicta postea veritus per cu, id 
          quodsi hendrerit definitiones pro. In nec animal tractatos, 
          per paulo congue ea.
        </p>
        <p>
          Nobis splendide ex nam. Vis at periculis delicatissimi. Vel 
          at elit dolores, sit aeque forensibus id. His erat saepe et, 
          everti sententiae pri te, accusam expetenda consequat eum cu. 
          Hinc omnis mei ei. His ei tantas animal.
        </p>
        <p>
          Quo et facete habemus posidonium, sed in esse eripuit 
          deserunt, modo adipiscing complectitur ut vix. Persius 
          labores eleifend an quo, eos et nostrum suscipiantur. Mei 
          ex liber euripidis incorrupte. Ius ei odio ridens, <a href="#">laoreet 
          maluisset at qui</a>. Eu harum necessitatibus pro, vitae 
          verterem repudiare eu has, solum concludaturque eam ei.
        </p>
        <p>
          In nec esse clita graeci, quodsi doctus ne est. Ad vim 
          detraxit elaboraret. Duo cibo verear ponderum ei. Te mei 
          patrioque consetetur. Cum cu mollis impetus. Vis an quas 
          graecis oportere, ut legimus vocibus mei.
        </p>
      </section>
      <div slot="filter">
        <span>Hi There, I'm a different view, for filtering!</span>
      </div>
      <div slot="details">
        <site-details></site-details>
      </div>
      <div>
        <span>I'm added to the default slot.</span>
      </div>
    </app-sidebar>
    <div id="map"></div>
  </div>
  
  <script>
    /* JAVASCRIPT */
    
      /* ~~~~~~~~ Map ~~~~~~~~ */
    //create a map, center it, and set the zoom level. 
    //set zoomcontrol to false because we will add it in a different corner. 
    var map = L.map('map', {zoomControl:false}).setView([45, -89.623861], 6);

    /* ~~~~~~~~ Map Layers ~~~~~~~~ */
    //basemap from Open Street Map
    var osm = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    /* ~~~~~~~~ Zoom Control ~~~~~~~~ */
    //place a zoom control in the top right: 
    new L.Control.Zoom({position: 'topright'}).addTo(map);

    /* +++++++++++ Springs layer +++++++++++ */ 
    var springs = L.esri.featureLayer({
        url: "https://data.wgnhs.wisc.edu/arcgis/rest/services/springs/springs_inventory/MapServer/1",
    }).addTo(map);

    var springPhotos = L.esri.featureLayer({
      url: "https://data.wgnhs.wisc.edu/arcgis/rest/services/springs/springs_inventory/MapServer/6"
    });

    var popupTemplate = "<h3>{County} County Spring #{SpringID}</h3>";

    springs.bindPopup(function(e){
        return L.Util.template(popupTemplate, e.feature.properties); 
    });

    springs.on('click', function(e) {
      var sidebar = document.querySelector('app-sidebar');
      var details = document.querySelector('site-details');
      var info = e.propagatedFrom.feature.properties;

      details['siteinfo'] = null;
      details['photos'] = null;
      springPhotos.query().where("Site_Code = '" + info['Site_Code'] + "'").run(function(err, col) {
        var photos = col.features.map( function(value, index) { return value.properties.FileURL; } );
        details['siteinfo'] = info;
        details['photos'] = photos;
        sidebar.switchTab('details');
      });
    })
  </script>
</body>
</html>
